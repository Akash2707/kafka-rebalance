apiVersion: batch/v1
kind: Job
metadata:
  name: kafka-rebalance-job
spec:
  parallelism: 1
  completions: 1
  backoffLimit: 5
  activeDeadlineSeconds: 240
  template:
    metadata:
      name: kafka-rebalance-job
    spec:
      restartPolicy: OnFailure
      containers:
      - name: kafka-rebalance
        image: {{ .Values.kafka_rebalance_image | quote }}
        imagePullPolicy: IfNotPresent
        env:
        - name: ZK_URL
          value: {{.Values.zk_url | quote}}
        - name: PROM_URL
          value: {{ .Values.prometheus_url | quote }}
        - name: BROKER_QUERY
          value: {{ .Values.broker_storage_query | quote}}
        - name : PARTITION_QUERY
          value: {{.Values.partition_size_query | quote}}
        command: ["kafkakit-prometheus-metricsfetcher","--zk-addr", {{.Values.zk_url | quote}}, "--prometheus-url",{{ .Values.prometheus_url | quote }},"--broker-storage-query",{{ .Values.broker_storage_query | quote}}, "--partition-size-query", {{.Values.partition_size_query | quote}}]
