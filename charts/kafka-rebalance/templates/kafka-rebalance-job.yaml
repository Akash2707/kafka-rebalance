apiVersion: apps/v1
kind: Deployment 
metadata:
  name: kafka-rebalance
  labels:
     app: kafka-rebalance
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kafka-rebalance
#   parallelism: 1
#   completions: 1
#   backoffLimit: 5
#   activeDeadlineSeconds: 240
  template:
    metadata:
      name: kafka-rebalance-job
      labels:
        app: kafka-rebalance    
    spec:
#       restartPolicy: OnFailure
      containers:
      - name: kafka-rebalance
        image: {{ .Values.global.kafka_rebalance_image | quote }}
        imagePullPolicy: IfNotPresent
        command: ["topicmappr","rebalance","--zk-addr", {{.Values.global.zk_url | quote}},"--topics",{{ .Values.topics | quote }},"--brokers",{{ .Values.brokers | quote }},"--partition-size-threshold",{{ .Values.partitionThreshold | quote }},"--storage-threshold",{{ .Values.storageThreshold | quote }},"--tolerance",{{ .Values.tolerance | quote }},"--verbose","--ignore-warns","|","grep -v","no-op"]
